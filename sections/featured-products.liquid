{% comment %}
  @file Featured Products Section
  @summary A customizable section to showcase featured or best-selling products
  @customizable
{% endcomment %}

<section class="section-featured-products py-12 md:py-16 lg:py-20 {% if section.settings.background_color == 'light' %}bg-naturah-cream{% elsif section.settings.background_color == 'dark' %}bg-naturah-dark{% elsif section.settings.background_color == 'accent' %}bg-naturah-green/10{% else %}bg-white{% endif %}" id="FeaturedProducts-{{ section.id }}">
  <div class="container mx-auto px-4">
    {% if section.settings.title != blank %}
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-bold mb-3">{{ section.settings.title }}</h2>
        {% if section.settings.subtitle != blank %}
          <p class="text-lg text-naturah-black/80 max-w-3xl mx-auto">{{ section.settings.subtitle }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% assign products_per_row = section.settings.products_per_row | default: 4 %}
    {% assign products_to_show = section.settings.products_to_show | default: 4 %}
    {% assign collection = collections[section.settings.collection] %}
    
    <div class="featured-products-grid grid-{{products_per_row}}-columns">
      {%- if collection != blank and collection.products.size > 0 -%}
        {%- for product in collection.products limit: products_to_show -%}
          <div class="product-card-wrapper">
            <div class="product-card rounded-lg overflow-hidden bg-white shadow-sm h-full flex flex-col">
              <div class="product-image-container relative pb-[100%] overflow-hidden bg-naturah-cream/30">
                {% if product.featured_media %}
                  <a href="{{ product.url }}">
                    <img
                      src="{{ product.featured_media | img_url: '533x' }}"
                      alt="{{ product.featured_media.alt | escape }}"
                      class="absolute inset-0 w-full h-full object-cover object-center hover:scale-105 transition-transform duration-300"
                      loading="lazy"
                      width="533"
                      height="533"
                    >
                  </a>
                {% else %}
                  <div class="absolute inset-0 flex items-center justify-center">
                    <svg class="w-16 h-16 text-naturah-green/40" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                  </div>
                {% endif %}
                
                {% if product.available == false %}
                  <span class="badge sold-out-badge absolute top-2 left-2 text-xs font-medium py-1 px-2 bg-naturah-black text-white rounded">
                    Sold Out
                  </span>
                {% elsif product.compare_at_price > product.price %}
                  <span class="badge sale-badge absolute top-2 left-2 text-xs font-medium py-1 px-2 bg-naturah-red text-white rounded">
                    Sale
                  </span>
                {% endif %}
              </div>

              <div class="product-info p-4 flex flex-col flex-grow">
                {% if section.settings.show_vendor and product.vendor %}
                  <div class="product-vendor text-xs text-naturah-black/60 mb-1">
                    {{ product.vendor }}
                  </div>
                {% endif %}
                
                <h3 class="product-title text-naturah-black font-medium mb-1">
                  <a href="{{ product.url }}" class="hover:text-naturah-green transition-colors duration-200">
                    {{ product.title }}
                  </a>
                </h3>

                <div class="product-price {% if product.compare_at_price > product.price %}sale{% endif %} mb-2">
                  <span class="price {% if product.compare_at_price > product.price %}text-naturah-red{% endif %}">
                    {{ product.price | money }}
                  </span>
                  {% if product.compare_at_price > product.price %}
                    <span class="compare-at-price text-naturah-black/60 text-sm line-through ml-2">
                      {{ product.compare_at_price | money }}
                    </span>
                  {% endif %}
                </div>

                {% if section.settings.show_description and product.description != blank %}
                  <div class="product-description text-sm text-naturah-black/70 mb-4 line-clamp-2">
                    {{ product.description | strip_html | truncatewords: 15 }}
                  </div>
                {% endif %}

                <div class="mt-auto">
                  {% if section.settings.show_quick_add and product.available %}
                    <form method="post" action="/cart/add" class="quick-add-form">
                      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                      <button type="submit" class="quick-add-button w-full px-4 py-2 text-sm font-medium text-white bg-naturah-green hover:bg-naturah-green-dark rounded-full transition-colors duration-200 flex items-center justify-center">
                        <span class="icon mr-2">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                          </svg>
                        </span>
                        <span>Add to Cart</span>
                      </button>
                    </form>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {%- endfor -%}
      {%- else -%}
        {%- for i in (1..4) -%}
          <div class="product-card-wrapper">
            <div class="product-card rounded-lg overflow-hidden bg-white shadow-sm h-full flex flex-col animate-pulse">
              <div class="product-image-container relative pb-[100%] bg-naturah-cream/30"></div>
              <div class="product-info p-4 flex flex-col">
                <div class="h-4 bg-naturah-cream/50 rounded w-1/3 mb-2"></div>
                <div class="h-5 bg-naturah-cream/50 rounded w-2/3 mb-3"></div>
                <div class="h-4 bg-naturah-cream/50 rounded w-1/4 mb-4"></div>
                <div class="h-3 bg-naturah-cream/50 rounded w-full mb-2"></div>
                <div class="h-3 bg-naturah-cream/50 rounded w-5/6"></div>
              </div>
            </div>
          </div>
        {%- endfor -%}
      {%- endif -%}
    </div>

    {% if section.settings.show_view_all and collection != blank and collection.products_count > products_to_show %}
      <div class="view-all-container text-center mt-10">
        <a href="{{ collection.url }}" class="view-all-button inline-block px-6 py-3 rounded-md font-medium text-base transition-colors duration-200 bg-naturah-green text-white hover:bg-naturah-green-dark">
          {{ section.settings.view_all_text | default: 'View All Products' }}
        </a>
      </div>
    {% endif %}
  </div>
</section>

<style>
  .featured-products-grid {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: 1fr;
  }
  
  @media (min-width: 640px) {
    .featured-products-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (min-width: 1024px) {
    .featured-products-grid.grid-2-columns {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .featured-products-grid.grid-3-columns {
      grid-template-columns: repeat(3, 1fr);
    }
    
    .featured-products-grid.grid-4-columns {
      grid-template-columns: repeat(4, 1fr);
    }
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

{% schema %}
{
  "name": "Featured Products",
  "tag": "section",
  "class": "section-featured-products",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "default": "Featured Products",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "subtitle",
      "default": "Shop our most popular products",
      "label": "Subheading"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "select",
      "id": "background_color",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "light",
          "label": "Light"
        },
        {
          "value": "dark",
          "label": "Dark"
        },
        {
          "value": "accent",
          "label": "Accent"
        }
      ],
      "default": "none",
      "label": "Background color"
    },
    {
      "type": "range",
      "id": "products_per_row",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 4,
      "label": "Products per row"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "Maximum products to show"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": true,
      "label": "Show vendor"
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "default": true,
      "label": "Show description"
    },
    {
      "type": "checkbox",
      "id": "show_quick_add",
      "default": true,
      "label": "Show quick add button"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "Show 'View all' button"
    },
    {
      "type": "text",
      "id": "view_all_text",
      "default": "View All Products",
      "label": "'View all' button text"
    }
  ],
  "presets": [
    {
      "name": "Featured Products",
      "settings": {
        "collection": "",
        "products_per_row": 4,
        "products_to_show": 4
      }
    }
  ]
}
{% endschema %}